#!/bin/bash -e

: ${DB_ENV_POSTGRES_USER?"DB_ENV_POSTGRES_USER not set"}
: ${DB_ENV_POSTGRES_PASSWORD?"DB_ENV_POSTGRES_PASSWORD not set"}
: ${CHANGELOG_FILE:="changelogs.xml"}

cat <<CONF> /liquibase.properties
  driver: org.postgresql.Driver
  classpath:/postgresql.jar
  url: jdbc:postgresql://$DB_PORT_5432_TCP_ADDR:$DB_PORT_5432_TCP_PORT/$POSTGRES_USER
  username: $DB_ENV_POSTGRES_USER
  password: $DB_ENV_POSTGRES_PASSWORD
  changeLogFile: /changelogs/$CHANGELOG_FILE
CONF

case "$1" in
  "update")
    liquibase update
    ;;

  "diff")
    echo "DIFF IS NOT IMPLEMENTED YET"
    exit 1
    ;;

  *)
    echo "liquibase.properties updated"
    ;;
esac
